# Что осталось разработать: План развития системы

**Дата:** 21 января 2026
**Статус:** Актуальный

---

## Текущее состояние

### Что уже реализовано и работает

| Компонент | Статус | Описание |
|-----------|--------|----------|
| AI-Куратор | Работает | Основной бот, отвечает на вопросы |
| AI-Контент-Менеджер | Работает | Генерация и публикация постов |
| YandexGPT интеграция | Работает | Генерация текста |
| YandexART интеграция | Работает | Генерация изображений |
| RAG система | Работает | База знаний 200 документов |
| Публикация в Topics | Работает | Посты в разные топики группы |
| Модерация постов | Работает | Approve/reject кнопки |
| Воронка продаж (базовая) | Работает | Inline-кнопки, квалификация |
| Планировщик напоминаний | Работает | Автонапоминания пользователям |

### Что реализовано, но требует доработки

| Компонент | Статус | Что нужно |
|-----------|--------|-----------|
| Система аналитики | Частично | Дотестировать /analytics, /top |
| Lead scoring | Частично | Протестировать на реальных данных |
| Уведомления о лидах | Частично | Проверить отправку админу |

---

## Что осталось разработать

### ФАЗА 1: Мультипартнёрский режим (Приоритет: ВЫСОКИЙ)

Это главное для масштабирования — возможность каждому партнёру иметь своего бота.

#### 1.1 Поддержка нескольких ботов на одном сервере

**Файлы для создания/изменения:**

```
scripts/
├── create_partner.py          ✅ СОЗДАН
├── manage_partners.py         ❌ НУЖНО СОЗДАТЬ
└── deploy_partner.py          ❌ НУЖНО СОЗДАТЬ

partners/                      ❌ НУЖНО СОЗДАТЬ СТРУКТУРУ
├── danil/
│   ├── .env
│   └── config.yaml
└── [partner_id]/
    ├── .env
    └── config.yaml
```

**Задачи:**
- [ ] Создать `manage_partners.py` — управление ботами (start/stop/restart/status)
- [ ] Создать `deploy_partner.py` — автоматический деплой на сервер
- [ ] Модифицировать `curator_bot/main.py` для чтения конфига из переменной окружения
- [ ] Создать шаблон systemd сервиса для партнёров
- [ ] Протестировать запуск нескольких ботов одновременно

**Оценка времени:** 8-12 часов

---

#### 1.2 Изоляция данных партнёров в БД

**Текущее состояние:** Все данные в общих таблицах без привязки к партнёру.

**Что нужно:**

```python
# Добавить partner_id во все таблицы
class User(Base):
    # ... существующие поля ...
    partner_id = Column(String(50), index=True)  # ДОБАВИТЬ

class FunnelEvent(Base):
    # ... существующие поля ...
    partner_id = Column(String(50), index=True)  # ДОБАВИТЬ

class Post(Base):
    # ... существующие поля ...
    partner_id = Column(String(50), index=True)  # ДОБАВИТЬ
```

**Задачи:**
- [ ] Создать миграцию для добавления `partner_id` в таблицы
- [ ] Обновить все запросы к БД — фильтрация по `partner_id`
- [ ] Обновить статистику — учитывать только данные партнёра
- [ ] Протестировать изоляцию данных

**Оценка времени:** 6-8 часов

---

#### 1.3 Загрузка конфигурации партнёра

**Что нужно:**

```python
# shared/config/partner_config.py — НОВЫЙ ФАЙЛ

import os
from pathlib import Path
import yaml

class PartnerConfig:
    def __init__(self):
        config_path = os.getenv('PARTNER_CONFIG')
        if config_path:
            self.load_from_path(config_path)
        else:
            self.load_default()

    def load_from_path(self, path: str):
        """Загрузка конфига партнёра из директории."""
        config_dir = Path(path)

        # Загружаем .env
        env_file = config_dir / '.env'
        if env_file.exists():
            load_dotenv(env_file)

        # Загружаем config.yaml
        yaml_file = config_dir / 'config.yaml'
        if yaml_file.exists():
            with open(yaml_file) as f:
                self.yaml_config = yaml.safe_load(f)

    @property
    def partner_id(self) -> str:
        return os.getenv('PARTNER_ID', 'default')

    @property
    def display_name(self) -> str:
        return os.getenv('BOT_DISPLAY_NAME', 'AI-Куратор')

    @property
    def nl_shop_link(self) -> str:
        return os.getenv('NL_SHOP_LINK', '')

    @property
    def nl_registration_link(self) -> str:
        return os.getenv('NL_REGISTRATION_LINK', '')
```

**Задачи:**
- [ ] Создать `shared/config/partner_config.py`
- [ ] Интегрировать в `curator_bot/main.py`
- [ ] Обновить промпты для использования данных партнёра
- [ ] Обновить генерацию ссылок

**Оценка времени:** 4-6 часов

---

### ФАЗА 2: Улучшение воронки продаж (Приоритет: СРЕДНИЙ)

#### 2.1 Цепочки прогрева

**Файлы:**
```
curator_bot/funnels/
├── warmup_sequences.py        ❌ НУЖНО СОЗДАТЬ
├── sequence_engine.py         ❌ НУЖНО СОЗДАТЬ
└── templates/
    ├── weight.yaml            ❌ НУЖНО СОЗДАТЬ
    ├── energy.yaml            ❌ НУЖНО СОЗДАТЬ
    ├── business.yaml          ❌ НУЖНО СОЗДАТЬ
    └── beauty.yaml            ❌ НУЖНО СОЗДАТЬ
```

**Задачи:**
- [ ] Создать структуру цепочек прогрева (YAML шаблоны)
- [ ] Реализовать движок обработки цепочек
- [ ] Интегрировать с планировщиком напоминаний
- [ ] Добавить отслеживание прогресса по цепочке
- [ ] Написать 4 цепочки: похудение, энергия, бизнес, красота

**Оценка времени:** 12-16 часов

---

#### 2.2 Сбор контактов

**Файлы:**
```
curator_bot/handlers/
└── contact_collector.py       ❌ НУЖНО СОЗДАТЬ
```

**Задачи:**
- [ ] Реализовать FSM для сбора телефона
- [ ] Добавить валидацию номера
- [ ] Сохранение в БД
- [ ] Уведомление партнёра о новом контакте
- [ ] Опциональный сбор email

**Оценка времени:** 4-6 часов

---

#### 2.3 Улучшение уведомлений о лидах

**Текущее:** Базовые уведомления реализованы.

**Что добавить:**
- [ ] Разные триггеры (контакт, клик на ссылку, высокая активность)
- [ ] Форматирование сообщений с полной информацией о лиде
- [ ] Кнопки быстрых действий (написать лиду, отметить как обработанного)
- [ ] Дневной дайджест горячих лидов

**Оценка времени:** 6-8 часов

---

### ФАЗА 3: Панель партнёра (Приоритет: СРЕДНИЙ)

#### 3.1 Команды для партнёра

**Файлы:**
```
curator_bot/handlers/
├── partner_panel.py           ❌ НУЖНО СОЗДАТЬ
└── partner_stats.py           ❌ НУЖНО СОЗДАТЬ
```

**Команды для реализации:**
- [ ] `/my_stats` — статистика партнёра (лиды, конверсии, заказы)
- [ ] `/my_leads` — список лидов с фильтрацией
- [ ] `/my_link` — реферальная ссылка на бота
- [ ] `/my_settings` — настройки профиля
- [ ] `/hot_leads` — только горячие лиды

**Оценка времени:** 8-10 часов

---

#### 3.2 Регистрация партнёра-лидера (если один бот на всех)

**Примечание:** Это для альтернативной архитектуры (один бот, много партнёров).
При текущей архитектуре (каждому свой бот) — не нужно.

---

### ФАЗА 4: Обучение и материалы (Приоритет: НИЗКИЙ)

#### 4.1 Обучающие материалы в боте

**Файлы:**
```
curator_bot/handlers/
└── training.py                ❌ НУЖНО СОЗДАТЬ

curator_bot/content/
├── training_content.yaml      ❌ НУЖНО СОЗДАТЬ
└── reels_templates.yaml       ❌ НУЖНО СОЗДАТЬ
```

**Задачи:**
- [ ] Команда `/training` с выбором темы
- [ ] Контент: как снимать Reels
- [ ] Контент: как использовать бота
- [ ] Контент: как работать с лидами
- [ ] Шаблоны текстов для Reels

**Оценка времени:** 6-8 часов

---

### ФАЗА 5: Оптимизация и масштабирование (Приоритет: НИЗКИЙ)

#### 5.1 Мониторинг и логирование

**Задачи:**
- [ ] Централизованные логи для всех ботов
- [ ] Метрики производительности
- [ ] Алерты при ошибках
- [ ] Dashboard со статусом всех ботов

**Оценка времени:** 8-12 часов

---

#### 5.2 Автоматическое масштабирование

**Задачи:**
- [ ] Скрипт для переноса на более мощный сервер
- [ ] Балансировка нагрузки (при 100+ ботах)
- [ ] Автоматический бэкап БД

**Оценка времени:** 10-15 часов

---

## Сводная таблица задач

| Задача | Приоритет | Время | Зависимости |
|--------|-----------|-------|-------------|
| **Мультипартнёрский режим** | | | |
| manage_partners.py | Высокий | 4ч | — |
| deploy_partner.py | Высокий | 4ч | manage_partners.py |
| Изоляция данных в БД | Высокий | 6-8ч | — |
| Загрузка конфига партнёра | Высокий | 4-6ч | — |
| **Улучшение воронки** | | | |
| Цепочки прогрева | Средний | 12-16ч | — |
| Сбор контактов | Средний | 4-6ч | — |
| Улучшение уведомлений | Средний | 6-8ч | — |
| **Панель партнёра** | | | |
| Команды /my_stats и др. | Средний | 8-10ч | Изоляция данных |
| **Обучение** | | | |
| Материалы в боте | Низкий | 6-8ч | — |
| **Масштабирование** | | | |
| Мониторинг | Низкий | 8-12ч | — |
| Автомасштабирование | Низкий | 10-15ч | Мониторинг |

**Общее время:** ~80-110 часов

---

## Рекомендуемый порядок реализации

### Этап 1: Базовый мультипартнёрский режим (2-3 дня)
1. Загрузка конфига партнёра
2. Изоляция данных в БД
3. manage_partners.py
4. Тестирование с 2-3 ботами

### Этап 2: Онбординг первых партнёров (1-2 дня)
1. Создать Google-форму
2. Протестировать create_partner.py
3. Подготовить инструкцию
4. Онбординг 2-3 партнёров

### Этап 3: Улучшение воронки (3-5 дней)
1. Цепочки прогрева
2. Сбор контактов
3. Улучшение уведомлений

### Этап 4: Панель партнёра (2-3 дня)
1. /my_stats
2. /my_leads
3. /hot_leads

### Этап 5: Обучение и масштабирование (по мере необходимости)
- Обучающие материалы
- Мониторинг
- Оптимизация

---

## Что делать прямо сейчас

### Немедленные действия:

1. **Создать Google-форму** по структуре из GOOGLE_FORM_STRUCTURE.md
2. **Протестировать create_partner.py** — создать тестового партнёра
3. **Модифицировать main.py** для чтения PARTNER_CONFIG

### Следующая сессия разработки:

1. Реализовать `shared/config/partner_config.py`
2. Добавить `partner_id` в модели БД
3. Создать миграцию
4. Протестировать изоляцию данных

---

## Документы проекта

| Документ | Описание | Статус |
|----------|----------|--------|
| [PARTNER_ONBOARDING_GUIDE.md](PARTNER_ONBOARDING_GUIDE.md) | Инструкция для партнёра | Готов |
| [GOOGLE_FORM_STRUCTURE.md](GOOGLE_FORM_STRUCTURE.md) | Структура формы | Готов |
| [IMPLEMENTATION_ROADMAP.md](IMPLEMENTATION_ROADMAP.md) | Общий план реализации | Готов |
| [SALES_FUNNEL_PLAN.md](SALES_FUNNEL_PLAN.md) | План воронки продаж | Готов |
| [SCALING_POTENTIAL.md](SCALING_POTENTIAL.md) | Расчёт потенциала | Готов |
| DEVELOPMENT_TODO.md | Этот документ | Актуальный |

---

**Последнее обновление:** 21 января 2026
