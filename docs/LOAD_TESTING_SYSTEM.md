# –°–∏—Å—Ç–µ–º–∞ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## –û–±–∑–æ—Ä

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è AI-–ö—É—Ä–∞—Ç–æ—Ä–∞ –∏ AI-–ö–æ–Ω—Ç–µ–Ω—Ç-–ú–µ–Ω–µ–¥–∂–µ—Ä–∞. –≠–º—É–ª–∏—Ä—É–µ—Ç –¥–æ 100 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç HTML-–æ—Ç—á—ë—Ç—ã —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏.

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

‚úÖ **100 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** —Å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º–∏ –ø—Ä–æ—Ñ–∏–ª—è–º–∏
‚úÖ **Smart Mock System** ‚Äî —ç–º—É–ª—è—Ü–∏—è AI –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö API –≤—ã–∑–æ–≤–æ–≤
‚úÖ **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** ‚Äî asyncio + Semaphore
‚úÖ **Ramp-up –Ω–∞–≥—Ä—É–∑–∫–∏** ‚Äî –ø–ª–∞–≤–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏
‚úÖ **Real-time –º–µ—Ç—Ä–∏–∫–∏** ‚Äî —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
‚úÖ **HTML –æ—Ç—á—ë—Ç—ã —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏** ‚Äî matplotlib charts
‚úÖ **CSV —ç–∫—Å–ø–æ—Ä—Ç** ‚Äî –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
‚úÖ **pytest –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** ‚Äî —É–¥–æ–±–Ω—ã–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ pytest

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
tests/
‚îú‚îÄ‚îÄ load_testing/              # –°–∏—Å—Ç–µ–º–∞ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ mocks/                 # Mock –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mock_ai_clients.py    # Smart mock AI —Å intent detection
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mock_rag.py           # Mock RAG engine (keyword search)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mock_persona.py       # Mock Persona Manager
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mock_funnel.py        # Mock Conversational Funnel
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ fixtures/              # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ personas.py           # 100 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ metrics/               # –°–±–æ—Ä –∏ –æ—Ç—á—ë—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ collector.py          # –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –≤ real-time
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ reporter.py           # Console + HTML reporters
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ user_simulator.py      # –≠–º—É–ª—è—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ load_runner.py         # –ì–ª–∞–≤–Ω—ã–π orchestrator
‚îÇ   ‚îú‚îÄ‚îÄ example_test.py        # –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ README.md              # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ
‚îú‚îÄ‚îÄ stress/                    # pytest —Ç–µ—Å—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ test_100_users.py      # Smoke, load, stress —Ç–µ—Å—Ç—ã
‚îÇ
‚îî‚îÄ‚îÄ conftest.py                # pytest –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install pytest pytest-asyncio matplotlib Jinja2
```

### 2. –ó–∞–ø—É—Å–∫ smoke test (10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

```bash
# –ß–µ—Ä–µ–∑ pytest
pytest tests/stress/test_100_users.py::test_smoke_10_users -v

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
cd tests/load_testing
python example_test.py
```

### 3. –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ (100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

```bash
pytest tests/stress/test_100_users.py::test_100_parallel_users -v
```

### 4. –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–û—Ç—á—ë—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `load_test_results/`:
- `{test_name}_raw_metrics.csv` ‚Äî –¥–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- `{test_name}_aggregated.csv` ‚Äî –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- `{test_name}_report.html` ‚Äî HTML –æ—Ç—á—ë—Ç —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏

–û—Ç–∫—Ä–æ–π—Ç–µ HTML –æ—Ç—á—ë—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≥—Ä–∞—Ñ–∏–∫–æ–≤.

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –∫—É—Ä–∞—Ç–æ—Ä–∞

```python
from tests.load_testing.load_runner import quick_curator_test

async def my_handler(message):
    # –í–∞—à handler
    await message.answer("–û—Ç–≤–µ—Ç –±–æ—Ç–∞")

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞
metrics = await quick_curator_test(
    bot_handler=my_handler,
    users=10,
    concurrent=5,
    max_messages=5
)

print(f"Error rate: {metrics['summary']['error_rate']:.2%}")
print(f"Avg response time: {metrics['aggregated']['avg_response_time_ms']:.0f} ms")
```

### –ü—Ä–∏–º–µ—Ä 2: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π —Ç–µ—Å—Ç

```python
from tests.load_testing.load_runner import LoadTestRunner, LoadTestConfig

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
config = LoadTestConfig(
    test_name="my_load_test",
    scenario="curator",
    total_users=50,
    concurrent_users=20,
    max_messages_per_user=7,
    delay_between_messages_sec=1.5,
    delay_variance_sec=1.0,
    ramp_up_duration_sec=10.0,  # –ü–ª–∞–≤–Ω—ã–π —Ä–æ—Å—Ç
    export_csv=True,
    export_html=True,
)

# –ó–∞–ø—É—Å–∫
runner = LoadTestRunner(config)
metrics = await runner.run(bot_handler=my_handler)
```

### –ü—Ä–∏–º–µ—Ä 3: –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç (500 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

```python
from tests.load_testing.load_runner import stress_test

metrics = await stress_test(
    bot_handler=my_handler,
    users=500,
    concurrent=100,
    max_messages=5
)
```

---

## –ú–µ—Ç—Ä–∏–∫–∏ –∏ SLA

### –¶–µ–ª–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (SLA)

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ |
|---------|------------------|-------------|
| Avg Response Time | < 1000 ms | < 2000 ms |
| P95 Response Time | < 1500 ms | < 3000 ms |
| P99 Response Time | < 2000 ms | < 5000 ms |
| Error Rate | < 0.1% | < 1% |
| Throughput | > 20 req/sec | > 10 req/sec |
| Concurrent Users | 100 | 50 |

### –°–æ–±–∏—Ä–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏

**Response Time:**
- Min, Max, Avg, Median
- P50, P95, P99 –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª–∏

**Throughput:**
- Requests per second
- Total requests
- Successful / Failed requests

**Distribution:**
- Intent distribution (product, business, skeptic, etc.)
- Segment distribution (A, B, C, D, E)
- Error distribution (–ø–æ —Ç–∏–ø–∞–º)

**Time Windows:**
- –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –æ–∫–Ω–∞–º (–∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥)
- –ü–æ–∑–≤–æ–ª—è—é—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏

---

## Mock System

### MockAnthropicClient

Smart mock —Å intent detection:
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç intent (product, business, skeptic, etc.)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤
- –≠–º—É–ª–∏—Ä—É–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É API (500ms ¬± 200ms)
- –°–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ calls/latency/intent_distribution

### MockRAGEngine

Keyword search –≤–º–µ—Å—Ç–æ vector search:
- –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –±–µ–∑ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î
- Keyword matching + scoring
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- 50+ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ mock knowledge base

### MockPersonaManager

–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–±–æ—Ä –ø–µ—Ä—Å–æ–Ω—ã:
- –í—ã–±–æ—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ post_type
- 3 –ø–µ—Ä—Å–æ–Ω—ã: expert, friend, motivator
- Hooks –¥–ª—è –∫–∞–∂–¥–æ–π –ø–µ—Ä—Å–æ–Ω—ã
- Temperature, tone, emoji

### MockConversationalFunnel

–£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–æ—Ä–æ–Ω–∫–∏:
- Intent detection (product, business, skeptic, curious)
- Temperature determination (HOT, WARM, COLD)
- Stage transitions (greeting ‚Üí discovery ‚Üí solution)
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –≤ –ø–∞–º—è—Ç–∏ (–±–µ–∑ –ë–î)

---

## 100 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –°–µ–≥–º–µ–Ω—Ç—ã –∞—É–¥–∏—Ç–æ—Ä–∏–∏

| –°–µ–≥–º–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | % | Intents |
|---------|----------|---|---------|
| A | –ú–∞–º—ã 30-45 –ª–µ—Ç | 25% | product, curious |
| B | –°—Ç—É–¥–µ–Ω—Ç—ã 18-25 | 20% | business, product |
| C | –ü–µ–Ω—Å–∏–æ–Ω–µ—Ä—ã 55+ | 15% | product, curious |
| D | –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã 25-40 | 25% | business, product |
| E | –°–∫–µ–ø—Ç–∏–∫–∏ | 15% | skeptic |

### Pain Points

- **weight** (30%) ‚Äî —Å–Ω–∏–∂–µ–Ω–∏–µ –≤–µ—Å–∞
- **energy** (20%) ‚Äî —ç–Ω–µ—Ä–≥–∏—è, –±–æ–¥—Ä–æ—Å—Ç—å
- **immunity** (15%) ‚Äî –∏–º–º—É–Ω–∏—Ç–µ—Ç
- **beauty** (20%) ‚Äî –∫—Ä–∞—Å–æ—Ç–∞, –∫–æ–∂–∞
- **money** (15%) ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥

### Behaviour Types

- **active** (40%) ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–µ, –º–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤
- **passive** (35%) ‚Äî –ø–∞—Å—Å–∏–≤–Ω—ã–µ, –∫–æ—Ä–æ—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã
- **skeptic** (25%) ‚Äî —Å–∫–µ–ø—Ç–∏–∫–∏, —Å–æ–º–Ω–µ–≤–∞—é—Ç—Å—è

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

–ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 5-10 —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ:
- Intent (product, business, curious, skeptic)
- Pain point (weight, energy, immunity, etc.)
- Behaviour (active, passive, skeptic)

---

## HTML –æ—Ç—á—ë—Ç—ã

HTML –æ—Ç—á—ë—Ç –≤–∫–ª—é—á–∞–µ—Ç:

### –ì—Ä–∞—Ñ–∏–∫–∏

1. **Response Time over Time** ‚Äî –ª–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫
2. **Throughput over Time** ‚Äî –ª–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫
3. **Error Rate over Time** ‚Äî –ª–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫
4. **Response Time Distribution** ‚Äî –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞
5. **Intent Distribution** ‚Äî –∫—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞
6. **Segment Distribution** ‚Äî –∫—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞

### Summary Cards

- Total Users
- Total Messages
- Avg Response Time (—Å —Ü–≤–µ—Ç–æ–≤–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–µ–π)
- Error Rate (—Å —Ü–≤–µ—Ç–æ–≤–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–µ–π)
- Throughput
- Total Duration

### –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è

- üü¢ **–ó–µ–ª—ë–Ω—ã–π** ‚Äî –º–µ—Ç—Ä–∏–∫–∞ –≤ —Ü–µ–ª–µ–≤–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ
- üü° **–ñ—ë–ª—Ç—ã–π** ‚Äî –º–µ—Ç—Ä–∏–∫–∞ –≤ –ø—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç–µ–ª—å–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ
- üî¥ **–ö—Ä–∞—Å–Ω—ã–π** ‚Äî –º–µ—Ç—Ä–∏–∫–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø–æ—Ä–æ–≥

---

## pytest –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ pytest

```bash
# Smoke test (–±—ã—Å—Ç—Ä—ã–π)
pytest tests/stress/test_100_users.py::test_smoke_10_users -v

# Load test (100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
pytest tests/stress/test_100_users.py::test_100_parallel_users -v

# Stress test (500 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –º–µ–¥–ª–µ–Ω–Ω—ã–π)
pytest tests/stress/test_100_users.py::test_stress_500_users -v -m slow
```

### –ú–∞—Ä–∫–µ—Ä—ã pytest

- `@pytest.mark.asyncio` ‚Äî –¥–ª—è async —Ç–µ—Å—Ç–æ–≤
- `@pytest.mark.slow` ‚Äî –¥–ª—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

### Assertions

–¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç SLA –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

```python
assert summary["error_rate"] < 0.01  # Error rate < 1%
assert aggregated["avg_response_time_ms"] < 2000  # < 2000 ms
assert aggregated["p95_response_time_ms"] < 3000  # < 3000 ms
assert summary["throughput_req_per_sec"] > 10  # > 10 req/sec
```

---

## CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### GitHub Actions (–ø—Ä–∏–º–µ—Ä)

```yaml
name: Load Tests

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  load-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      - name: Run smoke test
        run: |
          pytest tests/stress/test_100_users.py::test_smoke_10_users -v

      - name: Run load test (nightly only)
        if: github.event_name == 'schedule'
        run: |
          pytest tests/stress/test_100_users.py::test_100_parallel_users -v

      - name: Upload reports
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: load-test-reports
          path: load_test_results/
```

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: ImportError –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–æ–≤

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∫–æ—Ä–Ω–µ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –≤ PYTHONPATH:

```python
import sys
from pathlib import Path
project_root = Path(__file__).parent.parent.parent
sys.path.insert(0, str(project_root))
```

### –ü—Ä–æ–±–ª–µ–º–∞: matplotlib charts –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ matplotlib:

```bash
pip install matplotlib
```

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ backend:

```python
import matplotlib
matplotlib.use('Agg')  # Non-interactive backend
```

### –ü—Ä–æ–±–ª–µ–º–∞: –í—ã—Å–æ–∫–∏–π error rate –≤ —Ç–µ—Å—Ç–∞—Ö

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. Handler –≤—ã–∑—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è
2. Mock'–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. –°–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∞—è concurrency (—É–º–µ–Ω—å—à–∏—Ç–µ concurrent_users)

**–†–µ—à–µ–Ω–∏–µ:** –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤ CSV:

```bash
grep "False" load_test_results/*_raw_metrics.csv
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
1. –£–º–µ–Ω—å—à–∏—Ç–µ `max_messages_per_user`
2. –£–º–µ–Ω—å—à–∏—Ç–µ `total_users`
3. –£–≤–µ–ª–∏—á—å—Ç–µ `concurrent_users` (–µ—Å–ª–∏ –µ—Å—Ç—å —Ä–µ—Å—É—Ä—Å—ã)
4. –£–º–µ–Ω—å—à–∏—Ç–µ `delay_between_messages_sec`

---

## –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö mock'–æ–≤

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –≤ `tests/load_testing/mocks/`
2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ mock –∫–ª–∞—Å—Å —Å –º–µ—Ç–æ–¥–∞–º–∏ –∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ –≤ `load_runner.py`

–ü—Ä–∏–º–µ—Ä:

```python
# tests/load_testing/mocks/mock_database.py
class MockDatabase:
    def __init__(self):
        self.queries_count = 0

    async def execute_query(self, query: str):
        self.queries_count += 1
        # Mock implementation
        return {"result": "ok"}

    def get_metrics(self):
        return {"queries_count": self.queries_count}
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫

–†–∞—Å—à–∏—Ä—å—Ç–µ `MetricsCollector` –≤ `metrics/collector.py`:

```python
@dataclass
class RequestMetric:
    # ... existing fields
    custom_metric: float = 0.0  # –ù–æ–≤–∞—è –º–µ—Ç—Ä–∏–∫–∞

# –í collect()
self.records.append(RequestMetric(
    # ... existing
    custom_metric=custom_value
))
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

–†–∞—Å—à–∏—Ä—å—Ç–µ `LoadTestRunner` –≤ `load_runner.py`:

```python
async def run(self, bot_handler, custom_param=None):
    if self.config.scenario == "custom":
        await self._run_custom_scenario(bot_handler, custom_param)
```

---

## Best Practices

### 1. –ù–∞—á–∏–Ω–∞–π—Ç–µ —Å smoke test

–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –Ω–∞ –º–∞–ª–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ:

```bash
pytest tests/stress/test_100_users.py::test_smoke_10_users -v
```

### 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ramp-up

–ù–µ –≤–∫–ª—é—á–∞–π—Ç–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å—Ä–∞–∑—É:

```python
config = LoadTestConfig(
    ramp_up_duration_sec=10.0,  # –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π —Ä–æ—Å—Ç
    # ...
)
```

### 3. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ intents

–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —á—Ç–æ —Ç–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

```python
print("Intent distribution:")
for intent, count in ai_metrics["intent_distribution"].items():
    print(f"  {intent}: {count}")
```

### 4. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–í—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–∞–π—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞:

```python
config = LoadTestConfig(
    export_csv=True,
    export_html=True,
    # ...
)
```

### 5. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å —Ç–µ—Å—Ç–∞–º–∏ —Å–ª–µ–¥–∏—Ç–µ –∑–∞:
- CPU usage
- Memory usage
- Database connections
- Network I/O

---

## FAQ

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –ë–î –≤–º–µ—Å—Ç–æ SQLite?**

A: –î–∞, —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ PostgreSQL fixtures –≤ `tests/conftest.py` –∏ –∏–∑–º–µ–Ω–∏—Ç–µ TEST_DATABASE_URL.

**Q: –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π AI (–Ω–µ mock)?**

A: –ó–∞–º–µ–Ω–∏—Ç–µ mock clients –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –≤ —Ç–µ—Å—Ç–µ, –Ω–æ —É—á—Ç–∏—Ç–µ —á—Ç–æ —ç—Ç–æ –¥–æ—Ä–æ–≥–æ ($$$ –Ω–∞ API calls) –∏ –º–µ–¥–ª–µ–Ω–Ω–æ.

**Q: –°–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–æ–∂–Ω–æ —ç–º—É–ª–∏—Ä–æ–≤–∞—Ç—å?**

A: –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ—Å—É—Ä—Å–æ–≤. Mock —Å–∏—Å—Ç–µ–º–∞ –ª–µ–≥–∫–æ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å 500+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏. –†–µ–∞–ª—å–Ω—ã–µ –±–æ—Ç—ã ‚Äî 50-100 –º–∞–∫—Å–∏–º—É–º.

**Q: –ö–∞–∫ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å CI/CD?**

A: –°–º. —Ä–∞–∑–¥–µ–ª "CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è" –≤—ã—à–µ. Smoke test –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –Ω–∞ –∫–∞–∂–¥—ã–π PR, full load test ‚Äî nightly.

**Q: –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –æ—Ç—á—ë—Ç—ã?**

A: –í `load_test_results/` (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [–ü–ª–∞–Ω —Å–∏—Å—Ç–µ–º—ã](./.claude/plans/elegant-baking-milner.md)
- [README load_testing](../tests/load_testing/README.md)
- [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](../tests/load_testing/example_test.py)
- [pytest –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.pytest.org/)
- [matplotlib charts](https://matplotlib.org/stable/gallery/index.html)

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Ç–µ—Å—Ç–æ–≤
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ CSV –æ—Ç—á—ë—Ç—ã –Ω–∞ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
4. –°–æ–∑–¥–∞–π—Ç–µ issue —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 3 —Ñ–µ–≤—Ä–∞–ª—è 2026
**–ê–≤—Ç–æ—Ä—ã:** Claude Sonnet 4.5 + Mafio
