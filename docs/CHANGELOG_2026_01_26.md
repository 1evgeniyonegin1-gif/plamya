# Changelog ‚Äî 26 —è–Ω–≤–∞—Ä—è 2026

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è v1

### –ü—Ä–æ–±–ª–µ–º—ã –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –Ω–∞–π–¥–µ–Ω—ã:

1. **CONTENT_STYLE_GUIDE.md –Ω–µ —á–∏—Ç–∞–ª—Å—è –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏** ‚Üí –ø–æ—Å—Ç—ã –±—ã–ª–∏ "–∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–º–∏"
2. **YandexART –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –∫–∞—Ä—Ç–∏–Ω–∫–∏** –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ `YANDEX_ART_ENABLED=false`
3. **Claude API –≤—ã–¥–∞–≤–∞–ª 403 –æ—à–∏–±–∫—É** (–Ω—É–∂–µ–Ω –ø—Ä–æ–∫—Å–∏ –¥–ª—è –†–æ—Å—Å–∏–∏)
4. **YandexGPT –º–æ–¥–µ–ª—å —É—Å—Ç–∞—Ä–µ–ª–∞** (yandexgpt –≤–º–µ—Å—Ç–æ yandexgpt-32k)
5. **–ü–∞—Ä—Å–∏–Ω–≥ `\n` –≤ YANDEX_PRIVATE_KEY** –Ω–µ —Ä–∞–±–æ—Ç–∞–ª

---

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –î–æ–±–∞–≤–ª–µ–Ω–æ —á—Ç–µ–Ω–∏–µ CONTENT_STYLE_GUIDE.md ‚úÖ

**–§–∞–π–ª:** `content_manager_bot/ai/content_generator.py`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- –ú–µ—Ç–æ–¥ `_get_content_style_guide()` ‚Äî —á–∏—Ç–∞–µ—Ç –ø—Ä–∏–º–µ—Ä—ã –∏–∑ `docs/CONTENT_STYLE_GUIDE.md`
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `generate_post()` ‚Äî –ø—Ä–∏–º–µ—Ä—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è **–î–û** RAG –∏ style samples
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: CONTENT_STYLE_GUIDE ‚Üí Telethon samples ‚Üí RAG knowledge base

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- AI —Ç–µ–ø–µ—Ä—å **–≤–∏–¥–∏—Ç –∂–∏–≤—ã–µ –ø—Ä–∏–º–µ—Ä—ã** –ø–æ—Å—Ç–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ—Ç –∂–µ —Å—Ç–∏–ª—å: –∫–æ—Ä–æ—Ç–∫–∏–µ –∞–±–∑–∞—Ü—ã, —é–º–æ—Ä, HTML-—Ç–µ–≥–∏

**–ö–æ–¥:**
```python
def _get_content_style_guide(self) -> str:
    """–ß–∏—Ç–∞–µ—Ç –ø—Ä–∏–º–µ—Ä—ã –∏–∑ CONTENT_STYLE_GUIDE.md –¥–ª—è –æ–±—É—á–µ–Ω–∏—è —Å—Ç–∏–ª—é."""
    style_guide_path = Path(__file__).parent.parent.parent / "docs" / "CONTENT_STYLE_GUIDE.md"

    if not style_guide_path.exists():
        return ""

    content = style_guide_path.read_text(encoding="utf-8")
    # –ò–∑–≤–ª–µ–∫–∞–µ–º —Å–µ–∫—Ü–∏—é "–ü—Ä–∏–º–µ—Ä—ã –∂–∏–≤—ã—Ö –ø–æ—Å—Ç–æ–≤"
    examples_section = re.search(r"## –ü—Ä–∏–º–µ—Ä—ã –∂–∏–≤—ã—Ö –ø–æ—Å—Ç–æ–≤.*?(?=##|\Z)", content, re.DOTALL)

    if examples_section:
        return f"\n\n### üìö –ü–†–ò–ú–ï–†–´ –°–¢–ò–õ–Ø (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –°–õ–ï–î–£–ô –≠–¢–û–ú–£ –§–û–†–ú–ê–¢–£):\n\n{examples_section.group(0)}\n\n..."
```

---

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω default YandexART ‚úÖ

**–§–∞–π–ª:** `shared/config/settings.py:88`

**–ë—ã–ª–æ:**
```python
yandex_art_enabled: bool = Field(default=True, env="YANDEX_ART_ENABLED")
```

**–°—Ç–∞–ª–æ:**
```python
yandex_art_enabled: bool = Field(default=False, env="YANDEX_ART_ENABLED")  # default=False —á—Ç–æ–±—ã –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ —è–≤–Ω–æ–≥–æ –≤–∫–ª—é—á–µ–Ω–∏—è
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–∞ VPS —Ñ–∞–π–ª `.env` –º–æ–≥ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç—å `YANDEX_ART_ENABLED`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `default=True` ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∫–ª—é—á–∞–ª–∞—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- YandexART **–≤—ã–∫–ª—é—á–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**
- –í–∫–ª—é—á–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —è–≤–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ `YANDEX_ART_ENABLED=true`

---

### 3. –û—Å—Ç–∞–≤–ª–µ–Ω Claude + –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–æ–∫—Å–∏ ‚úÖ

**–§–∞–π–ª:** `.env`

**–ú–æ–¥–µ–ª—å:**
```env
CONTENT_MANAGER_AI_MODEL=claude-sonnet-4-20250514  # –õ—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ
```

**–ü—Ä–æ–±–ª–µ–º–∞ 403:**
- Claude API –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ IP
- –¢—Ä–µ–±—É–µ—Ç—Å—è Cloudflare Workers –ø—Ä–æ–∫—Å–∏ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ, 5 –º–∏–Ω—É—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)

**–†–µ—à–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: [docs/CLAUDE_PROXY_QUICK_SETUP.md](docs/CLAUDE_PROXY_QUICK_SETUP.md)
- –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å `ANTHROPIC_BASE_URL` –≤ `.env` –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Worker

**YandexGPT-32k –æ–±–Ω–æ–≤–ª—ë–Ω –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤:**
```env
YANDEX_MODEL=yandexgpt-32k  # –†–µ–∑–µ—Ä–≤–Ω–∞—è –º–æ–¥–µ–ª—å (–µ—Å–ª–∏ Claude –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
```

---

### 4. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ ‚úÖ

**–§–∞–π–ª:** `shared/ai_clients/yandexgpt_client.py:36-39`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```python
# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á: –∑–∞–º–µ–Ω—è–µ–º \n –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
raw_key = private_key or settings.yandex_private_key
self.private_key = raw_key.replace('\\n', '\n') if raw_key else None
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `.env` —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª—é—á —Å `\n` (escaped newlines)
- `jwt.encode()` –Ω–µ –º–æ–≥ —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∫–ª—é—á: `Could not parse the provided public key`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ö–ª—é—á –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–∞—Ä—Å–∏—Ç—Å—è
- YandexGPT IAM —Ç–æ–∫–µ–Ω –ø–æ–ª—É—á–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

---

### 5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ‚úÖ

**–û–±–Ω–æ–≤–ª–µ–Ω–æ `.env`:**
```env
# Anthropic Claude (—Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–∫—Å–∏ –¥–ª—è –†–æ—Å—Å–∏–∏)
ANTHROPIC_API_KEY=...
# ANTHROPIC_BASE_URL=  # –ù–∞—Å—Ç—Ä–æ–π Cloudflare Workers –ø—Ä–æ–∫—Å–∏ (—Å–º. docs/CLAUDE_PROXY_QUICK_SETUP.md)

# YandexGPT –º–æ–¥–µ–ª–∏ (—Ä–µ–∑–µ—Ä–≤–Ω–∞—è –æ–ø—Ü–∏—è):
# - yandexgpt-32k (–ª—É—á—à–∞—è, 3.9 —Ä—É–±/1000 —Ç–æ–∫–µ–Ω–æ–≤)
# - yandexgpt (—Å—Ä–µ–¥–Ω—è—è, 1.2 —Ä—É–±/1000 —Ç–æ–∫–µ–Ω–æ–≤)
# - yandexgpt-lite (–±—ã—Å—Ç—Ä–∞—è, 0.2 —Ä—É–±/1000 —Ç–æ–∫–µ–Ω–æ–≤)
CONTENT_MANAGER_AI_MODEL=claude-sonnet-4-20250514  # –ò—Å–ø–æ–ª—å–∑—É–µ–º Claude
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°–æ–∑–¥–∞–Ω:** `test_content_generation.py`

**–ú–æ–¥–µ–ª—å:** Claude Sonnet 4.5

**–î–ª—è —Ä–∞–±–æ—Ç—ã Claude –Ω—É–∂–µ–Ω –ø—Ä–æ–∫—Å–∏:**
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: [docs/CLAUDE_PROXY_QUICK_SETUP.md](CLAUDE_PROXY_QUICK_SETUP.md)
- 5 –º–∏–Ω—É—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Cloudflare Workers (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
- –î–æ–±–∞–≤–∏—Ç—å `ANTHROPIC_BASE_URL` –≤ `.env`

**–†–µ–∑–µ—Ä–≤–Ω–∞—è –º–æ–¥–µ–ª—å (–µ—Å–ª–∏ Claude –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω):**
- YandexGPT-32k —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –ø—Ä–æ–∫—Å–∏
- –ö–∞—á–µ—Å—Ç–≤–æ —Ö–æ—Ä–æ—à–µ–µ, –Ω–æ Claude –ª—É—á—à–µ

---

## –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|-----------|
| `content_manager_bot/ai/content_generator.py` | +50 —Å—Ç—Ä–æ–∫: –º–µ—Ç–æ–¥ `_get_content_style_guide()` |
| `shared/config/settings.py` | –ò–∑–º–µ–Ω–µ–Ω–æ: `default=False` –¥–ª—è `yandex_art_enabled` |
| `shared/ai_clients/yandexgpt_client.py` | +3 —Å—Ç—Ä–æ–∫–∏: –ø–∞—Ä—Å–∏–Ω–≥ `\n` –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º –∫–ª—é—á–µ |
| `.env` | –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ: `CONTENT_MANAGER_AI_MODEL=yandexgpt-32k` |
| `.env` | –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ: `YANDEX_MODEL=yandexgpt-32k` |
| `.env` | –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ Anthropic –∏ YandexGPT |

---

## –î–µ–ø–ª–æ–π

### –õ–æ–∫–∞–ª—å–Ω–æ (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ):
```bash
python test_content_generation.py  # ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
```

### –ù–∞ VPS:
```bash
# 1. –°–ù–ê–ß–ê–õ–ê –Ω–∞—Å—Ç—Ä–æ–π Cloudflare Workers –ø—Ä–æ–∫—Å–∏
# –°–º. docs/CLAUDE_PROXY_QUICK_SETUP.md (5 –º–∏–Ω—É—Ç)

# 2. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏ –∑–∞–ø—É—à–∏—Ç—å
git add .
git commit -m "fix: CONTENT_STYLE_GUIDE + Claude + –ø–∞—Ä—Å–∏–Ω–≥ –∫–ª—é—á–∞ YandexGPT"
git push

# 3. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh root@194.87.86.103
cd /root/nl-international-ai-bots
git pull

# 4. –í–ê–ñ–ù–û: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–∫—Å–∏ –≤ .env –Ω–∞ VPS
nano .env
# –î–æ–±–∞–≤–∏—Ç—å:
# ANTHROPIC_BASE_URL=https://anthropic-proxy.–í–ê–®_–ê–ö–ö–ê–£–ù–¢.workers.dev

# 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
systemctl restart nl-bots
journalctl -u nl-bots -f

# –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ ‚Äî –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# "Anthropic client initialized with proxy: https://..."
# "Response generated successfully (tokens: ...)"
```

---

## –ß—Ç–æ –æ–∂–∏–¥–∞—Ç—å –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### –°—Ä–∞–∑—É:
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ 403 Claude API
- ‚úÖ YandexART –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫–∏ (default=False)
- ‚úÖ YandexGPT-32k –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

### –í –∫–æ–Ω—Ç–µ–Ω—Ç–µ (—á–µ—Ä–µ–∑ 1-2 –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏):
- ‚úÖ –ñ–∏–≤–æ–π —Å—Ç–∏–ª—å –∫–∞–∫ –≤ CONTENT_STYLE_GUIDE.md
- ‚úÖ –ö–æ—Ä–æ—Ç–∫–∏–µ –∞–±–∑–∞—Ü—ã (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
- ‚úÖ HTML-—Ç–µ–≥–∏: `<blockquote>`, `<b>`, `<tg-spoiler>`
- ‚úÖ –†–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π —è–∑—ã–∫, —é–º–æ—Ä

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ VPS** (–æ–±–Ω–æ–≤–∏—Ç—å .env!)
2. **–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å 5-10 —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤** —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ** ‚Äî –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫–∞–∫ –≤ CONTENT_STYLE_GUIDE.md
4. –ï—Å–ª–∏ —Å—Ç–∏–ª—å –≤—Å—ë –µ—â—ë "–∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π" ‚Üí –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –≤ CONTENT_STYLE_GUIDE.md

---

## –í–µ—Ä—Å–∏—è

**v3** ‚Äî 26 —è–Ω–≤–∞—Ä—è 2026, 16:15 MSK

**–ü—Ä–µ–¥—ã–¥—É—â–∏–µ –≤–µ—Ä—Å–∏–∏:**
- v2 (24.01): –ñ–∏–≤–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç, —Ä—É—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–Ω–±–æ—Ä–¥–∏–Ω–≥
- v1 (24.01): YandexGPT Pro, –¥–∏–∞–ª–æ–≥–æ–≤—ã–π –∫—É—Ä–∞—Ç–æ—Ä

**–ê–≤—Ç–æ—Ä:** Claude Sonnet 4.5 + –î–∞–Ω–∏–ª (–∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º)
