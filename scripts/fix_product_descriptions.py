"""
Fix wrong matches and add descriptions for unmatched products.
Run AFTER update_product_descriptions.py.
"""
import json
import os

BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
PRODUCTS_DB = os.path.join(BASE_DIR, "content", "products_database.json")

# Manual description overrides: product name -> correct description
OVERRIDES = {
    # ===== WRONG MATCHES TO FIX =====

    # Hair care - were matched to Travel Set instead of specific Occuba products
    "Шампунь восстанавливающий Silky hair repair":
        "Восстанавливающий шампунь с конским маслом и кератином для поврежденных волос. Интенсивно питает, восстанавливает и возвращает волосам жизненную силу и блеск.",
    "Кондиционер восстанавливающий Silky hair repair":
        "Восстанавливающий кондиционер с конским маслом и кератином для поврежденных волос. Интенсивно питает, восстанавливает структуру и возвращает здоровый блеск.",
    "Маска восстанавливающая Silky hair repair":
        "Восстанавливающая маска с конским маслом, кератином и экстрактами брокколи и ламинарии. Обеспечивает глубокое восстановление и шелковый блеск волос.",
    "Шампунь объем и сила Volume & strength":
        "Шампунь для тонких волос с муцином улитки и маслами арганы и баобаба. Придает объем и силу, укрепляет структуру волос без утяжеления.",
    "Шампунь балансирующий Shine balance":
        "Балансирующий шампунь для жирных волос с алмазной пудрой и маслом авокадо. Бережно очищает, регулирует жирность и придает волосам мягкость и сияние.",
    "Кондиционер объем и сила Volume & strength":
        "Кондиционер для тонких волос с муцином улитки и протеинами. Создает эффект естественной густоты и объема, укрепляет и восстанавливает.",
    "Кондиционер балансирующий Shine balance":
        "Балансирующий кондиционер для жирных волос с алмазной пудрой и протеинами. Регулирует жирность, придает легкость и здоровое сияние без утяжеления.",

    # Sunscreen - was matched to Lovely product
    "Крем солнцезащитный для лица 50 SPF":
        "Солнцезащитный крем для лица с SPF 50 и UVA/UVB защитой. Предотвращает фотостарение, ожоги и пигментацию, одновременно увлажняя кожу.",
    "Крем солнцезащитный для тела 50 SPF":
        "Солнцезащитный крем для тела с SPF 50 и UVA/UVB защитой. Предотвращает фотостарение и солнечные ожоги, увлажняет и смягчает кожу.",

    # ED Smart flavors matched to generic
    "ED Smart Classic Ягодная панна-котта, 15 порций":
        "Коктейль ED Smart со вкусом ягодной панна-котты. Полноценная замена приема пищи с оптимальным балансом белков, жиров, углеводов, витаминов и минералов.",
    "ED Smart Classic Банан, 15 порций":
        "Коктейль ED Smart со вкусом банана (205 ккал, 16.2 г белка). Быстрый полноценный прием пищи за 30 секунд.",
    "ED Smart Classic Шоколадный маффин, 15 порций":
        "Коктейль ED Smart со вкусом шоколадного маффина (204 ккал, 16.8 г белка). Десертный вкус при контроле калорий.",
    "ED Smart Classic Капучино, 15 порций":
        "Коктейль ED Smart со вкусом капучино (205 ккал, 16.6 г белка). Сбалансированное питание с кофейным вкусом.",
    "ED Smart Classic Красный Бархат, 15 порций":
        "Коктейль ED Smart со вкусом красного бархата (213 ккал, 16.5 г белка). Десертный коктейль для замены приема пищи.",
    "ED Smart Classic Молочный шоколад, 15 порций":
        "Коктейль ED Smart со вкусом молочного шоколада (213 ккал, 16.5 г белка). Нежный шоколадный вкус для сбалансированного питания.",
    "ED Smart Classic Манго-Маракуйя, 15 порций":
        "Коктейль ED Smart со вкусом манго и маракуйи (205 ккал, 16.2 г белка). Тропический вкус для полноценного приема пищи.",
    "ED Smart Classic Айриш Крим, 15 порций":
        "Коктейль ED Smart со вкусом айриш крим (202 ккал, 16.5 г белка). Десертный вкус для полноценного приема пищи.",
    "ED Smart Classic Дыня, 15 порций":
        "Коктейль ED Smart со вкусом дыни (204 ккал, 16.3 г белка). Освежающий вкус для замены приема пищи.",
    "ED Smart Milky Фисташковое мороженое, 15 порций":
        "Коктейль ED Smart Milky на молочном белке без сои со вкусом фисташки. Полноценная замена приема пищи с повышенным содержанием белка.",
    "ED Smart Classic Малина, 15 порций":
        "Коктейль ED Smart со вкусом малины (204 ккал, 16.2 г белка). Ягодный коктейль для контроля веса.",
    "ED Smart Classic Черника-Голубика, 15 порций":
        "Коктейль ED Smart со вкусом черники и голубики (204 ккал, 16.2 г белка). Ягодный коктейль с полным набором нутриентов.",
    "ED Smart Milky Клубника в шоколаде, 15 порций":
        "Коктейль ED Smart Milky на молочном белке без сои со вкусом клубничного десерта. Полноценная замена приема пищи для контроля веса.",
    "ED Smart Soup Томатный, 15 порций":
        "Функциональный суп для замены приема пищи со вкусом томата и базилика. Содержит сбалансированный комплекс нутриентов, готовится за 1.5 минуты.",

    # Vitamin B9+B12 was matched to D3
    "Vitamin В9+В12 - Витамин В9+В12":
        "Комплекс витаминов B9 (метилфолат) и B12 (метилкобаламин) для системы кроветворения. Поддерживает когнитивные функции, помогает при подготовке к беременности и улучшает сон.",

    # PH Balance matched to shampoo
    "Камешки для ощелачив рн воды PH Balance Stones":
        "Камни для ощелачивания воды PH Balance. Минерализуют и ощелачивают питьевую воду, делая её более полезной для организма.",

    # Fineffect Shine matched to shampoo
    "Салфетка Shine для стёкол":
        "Микрофибровая салфетка Fineffect для мытья стёкол и зеркал. Очищает без разводов, используется только с водой без химии.",

    # Витамин-желе matched to Greenflash Kids
    "Витамин-желе multi-effect, Манго":
        "Мультивитаминное желе для взрослых со вкусом манго. Вкусная и удобная форма приёма витаминов для поддержки иммунитета и энергии.",
    "Витамин-желе Multi-effect, Клубника":
        "Мультивитаминное желе для взрослых со вкусом клубники. Вкусная и удобная форма приёма витаминов для поддержки иммунитета и энергии.",

    # ===== UNMATCHED PRODUCTS: MANUAL DESCRIPTIONS =====

    # Уход за волосами
    "Спрей для легкого расчесывания":
        "Спрей-кондиционер для легкого расчесывания волос. Облегчает укладку, придает мягкость и защищает от повреждений.",

    # Уход за телом
    "Трюфели":
        "Шоколадные трюфели NL International. Полезное лакомство из натуральных ингредиентов.",
    "Ароматическая свеча":
        "Ароматическая свеча NL с натуральными эфирными маслами. Создает уютную атмосферу и наполняет дом приятным ароматом.",

    # Energy Diet
    "Коктейль «Фисташка»":
        "Коктейль ED Smart Milky со вкусом фисташки на молочном белке без сои. Полноценная замена приема пищи с повышенным содержанием белка.",
    "Коктейль «Соленая карамель»":
        "Коктейль ED Smart со вкусом соленой карамели. Сбалансированное питание для контроля веса с десертным вкусом.",
    "Коктейль «Кофе»":
        "Коктейль ED Smart со вкусом кофе. Сбалансированное питание с бодрящим кофейным вкусом для замены приёма пищи.",
    "Коктейль «Банан»":
        "Коктейль ED Smart со вкусом банана (205 ккал, 16.2 г белка). Быстрый полноценный прием пищи за 30 секунд.",
    "Коктейль «Ваниль»":
        "Коктейль ED Smart со вкусом ванили (205 ккал, 16.3 г белка). Сбалансированное питание для контроля веса.",
    "Микс протеинового печенья NL с суфле":
        "Микс протеинового печенья NL с суфле — вкусный белковый перекус. Высокое содержание белка при контроле калорий.",
    "Горячий напиток «Малина»":
        "Горячий функциональный напиток со вкусом малины из линейки Energy Diet. Согревающий перекус с витаминами и минералами.",
    "Фруктовые батончики «Финиковый MIX»":
        "Фруктовые батончики с финиковой основой — набор ассорти. Натуральный полезный перекус без сахара.",
    "Фруктовые батончики «Шоколадный MIX»":
        "Фруктовые батончики в шоколадной глазури — набор ассорти. Полезный перекус с натуральными ингредиентами.",

    # Greenflash БАД — NL branded merch
    "Толстовка NL, синяя S/M":
        "Брендированная синяя толстовка NL International размера S/M. Стильная одежда для партнёров.",
    "Комплект «Шапка и шарф NL», серый":
        "Брендированный комплект NL: шапка + шарф серого цвета. Стильные аксессуары для партнёров.",
    "Комплект «Шапка и шарф NL», мокко":
        "Брендированный комплект NL: шапка + шарф цвета мокко. Стильные аксессуары для партнёров.",
    "Футболка NL, сливочная M/L":
        "Брендированная сливочная футболка NL International размера M/L. Стильная одежда для партнёров.",
    "Удлиненная футболка NL, какао M/L":
        "Удлинённая брендированная футболка NL International цвета какао M/L. Модная одежда для партнёров.",
    "Свитшот NL, какао M/L":
        "Брендированный свитшот NL International цвета какао размера M/L. Комфортная одежда для партнёров.",
    "Свитшот NL, какао XL/XXL":
        "Брендированный свитшот NL International цвета какао размера XL/XXL. Комфортная одежда для партнёров.",
    "Свитшот NL, сливочный XL/XXL":
        "Брендированный сливочный свитшот NL International размера XL/XXL. Комфортная одежда для партнёров.",
    "Свитшот NL, сливочный M/L":
        "Брендированный сливочный свитшот NL International размера M/L. Комфортная одежда для партнёров.",
    "Толстовка NL, синяя M/L":
        "Брендированная синяя толстовка NL International размера M/L. Стильная одежда для партнёров.",
    "Толстовка NL, синяя XL":
        "Брендированная синяя толстовка NL International размера XL. Стильная одежда для партнёров.",
    "Общеукрепляющий комплекс для собак":
        "Общеукрепляющий витаминный комплекс для собак. Поддерживает здоровье, иммунитет и активность питомца.",
    "Общеукрепляющий комплекс для кошек":
        "Общеукрепляющий витаминный комплекс для кошек. Поддерживает здоровье, иммунитет и красоту шерсти.",
    "Комплекс для кастрированных котов и стерилизованных кошек":
        "Специализированный витаминный комплекс для кастрированных/стерилизованных питомцев. Поддерживает здоровый вес и мочевыделительную систему.",

    # Для детей NLka
    "Пастилки Happy Smile витаминизированные, 60 шт.":
        "Витаминизированные пастилки Happy Smile для детей (60 шт). Укрепляют зубы, содержат кальций и витамины.",

    # Чай и напитки
    "Черный индийский чай с душистыми травами":
        "Чёрный индийский чай из линейки Enerwood с душистыми травами. Ароматный согревающий напиток.",
    "Чайное ассорти":
        "Ассорти чаёв из линейки Enerwood. Набор разных вкусов для знакомства с коллекцией.",
    "Зеленый китайский чай с мятой и лимоном":
        "Зелёный китайский чай с мятой и лимоном из линейки Enerwood. Освежающий тонизирующий напиток.",
    "Красный чай с малиной и шиповником":
        "Красный чай с малиной и шиповником из линейки Enerwood. Согревающий витаминный напиток для иммунитета.",
    "Черный цейлонский чай":
        "Чёрный цейлонский чай из линейки Enerwood. Классический крепкий чай с насыщенным вкусом.",
    "NL Lux Фиточай – «Люкс» Фиточай":
        "Фиточай NL Lux из линейки Enerwood с травяным составом. Натуральный напиток для здоровья и тонуса.",
    "NL Vodoley Фиточай – «Водолей» Фиточай":
        "Фиточай NL Vodoley из линейки Enerwood. Натуральный травяной напиток для баланса и гармонии.",
    "NL Liverpool Фиточай – «Ливерпуль» Фиточай":
        "Фиточай NL Liverpool из линейки Enerwood. Натуральный травяной напиток с тонизирующим эффектом.",
    "NL Prana Фиточай – «Прана» Фиточай":
        "Фиточай NL Prana из линейки Enerwood. Натуральный травяной напиток для жизненной энергии.",
    "NL Valery Фиточай – «Валери» Фиточай":
        "Фиточай NL Valery из линейки Enerwood. Натуральный травяной напиток с приятным вкусом.",
    "NL Gentleman Фиточай – «Джентльмен» Фиточай":
        "Фиточай NL Gentleman из линейки Enerwood. Натуральный травяной напиток для мужской энергии.",
    "NL Donna Bella Фиточай – «Донна Белла» Фиточай":
        "Фиточай NL Donna Bella из линейки Enerwood. Натуральный женский травяной напиток для красоты.",

    # Курсы (обучение)
    "Курс «Основы нутрициологии». Тариф «Самостоятельный»":
        "Онлайн-курс по основам нутрициологии от NL International. Самостоятельное изучение принципов здорового питания.",
    "Курс «Основы нутрициологии». Тариф «Любознательный»":
        "Онлайн-курс по основам нутрициологии от NL International. Расширенный тариф с дополнительными материалами.",
    "Курс «Видео на коленке»":
        "Курс по созданию видеоконтента от NL International. Научитесь снимать качественные видео для продвижения.",
    "Курс «ЦелеНавигатор»":
        "Курс по постановке и достижению целей от NL International. Практические инструменты планирования.",
    "Курс «Конструктор твоей уверенности»":
        "Курс по развитию уверенности и лидерских качеств от NL International.",
    "Курс «TIMEHACK: как всё успевать»":
        "Курс по тайм-менеджменту от NL International. Практические техники управления временем.",
    "Курс «Быстрокурс: пойми меня»":
        "Экспресс-курс по коммуникации от NL International. Научитесь лучше понимать и убеждать людей.",
    "Курс «Сторителлинг»":
        "Курс по сторителлингу от NL International. Научитесь рассказывать истории, которые продают.",
    "Курс «Антиэйдж». Тариф «Любознательный»":
        "Курс по антивозрастному уходу от NL International. Расширенный тариф с дополнительными материалами.",
    "Курс «Антиэйдж». Тариф «Самостоятельный»":
        "Курс по антивозрастному уходу от NL International. Самостоятельное изучение anti-age программ.",

    # Для дома — Fineffect
    "Салфетка Soft деликатная":
        "Деликатная микрофибровая салфетка Fineffect Soft. Подходит для нежных поверхностей и чувствительных материалов.",
    "Салфетка Superfiber для влажной уборки":
        "Салфетка Fineffect Superfiber для влажной уборки. Эффективно удаляет загрязнения без использования химии.",
}


def main():
    with open(PRODUCTS_DB, 'r', encoding='utf-8') as f:
        db = json.load(f)

    fixed = 0
    added = 0

    for cat_name, products in db['categories'].items():
        for product in products:
            name = product['name']
            if name in OVERRIDES:
                had_desc = bool(product.get('description'))
                product['description'] = OVERRIDES[name]
                if had_desc:
                    fixed += 1
                else:
                    added += 1

    # Count products with descriptions
    total = 0
    with_desc = 0
    without_desc = []
    for cat_name, products in db['categories'].items():
        for product in products:
            total += 1
            if product.get('description'):
                with_desc += 1
            else:
                without_desc.append(f"[{cat_name}] {product['name']}")

    print(f"Fixed wrong matches: {fixed}")
    print(f"Added new descriptions: {added}")
    print(f"Total with descriptions: {with_desc}/{total}")

    if without_desc:
        print(f"\nStill without descriptions ({len(without_desc)}):")
        for p in without_desc:
            print(f"  {p}")

    with open(PRODUCTS_DB, 'w', encoding='utf-8') as f:
        json.dump(db, f, ensure_ascii=False, indent=2)

    print(f"\nSaved updated products_database.json")


if __name__ == '__main__':
    main()
