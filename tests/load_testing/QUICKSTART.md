# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç ‚Äî –°–∏—Å—Ç–µ–º–∞ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## –ß—Ç–æ —ç—Ç–æ?

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å —ç–º—É–ª—è—Ü–∏–µ–π **100 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**, smart mock'–∞–º–∏ AI –∏ –∫—Ä–∞—Å–∏–≤—ã–º–∏ HTML-–æ—Ç—á—ë—Ç–∞–º–∏ —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏.

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ (30 —Å–µ–∫)

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install matplotlib Jinja2

# pytest —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ requirements.txt

# 2. –í—Å—ë –≥–æ—Ç–æ–≤–æ!
```

---

## –ó–∞–ø—É—Å–∫ (1 –º–∏–Ω—É—Ç–∞)

### –í–∞—Ä–∏–∞–Ω—Ç 1: Smoke test (10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

```bash
pytest tests/stress/test_100_users.py::test_smoke_10_users -v
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ~ 10 —Å–µ–∫—É–Ω–¥, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∞–∑–æ–≤—É—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

### –í–∞—Ä–∏–∞–Ω—Ç 2: Full load test (100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

```bash
pytest tests/stress/test_100_users.py::test_100_parallel_users -v
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ~ 2-3 –º–∏–Ω—É—Ç—ã, –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —Å –æ—Ç—á—ë—Ç–∞–º–∏

### –í–∞—Ä–∏–∞–Ω—Ç 3: Stress test (500 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

```bash
pytest tests/stress/test_100_users.py::test_stress_500_users -v
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ~ 5-10 –º–∏–Ω—É—Ç, –≤—ã—è–≤–ª—è–µ—Ç bottlenecks

---

## –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ:

```
load_test_results/
‚îú‚îÄ‚îÄ {test_name}_report.html     ‚Üê –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ!
‚îú‚îÄ‚îÄ {test_name}_raw_metrics.csv
‚îî‚îÄ‚îÄ {test_name}_aggregated.csv
```

HTML –æ—Ç—á—ë—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç:
- 6 –≥—Ä–∞—Ñ–∏–∫–æ–≤ (response time, throughput, error rate, etc.)
- Summary cards —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
- –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è (üü¢ üü° üî¥)

---

## –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è?

### AI-–ö—É—Ä–∞—Ç–æ—Ä
- ‚úÖ 100 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–∞–∑–Ω—ã–º–∏ –ø—Ä–æ—Ñ–∏–ª—è–º–∏
- ‚úÖ 5 —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ (–º–∞–º—ã, —Å—Ç—É–¥–µ–Ω—Ç—ã, –ø–µ–Ω—Å–∏–æ–Ω–µ—Ä—ã, —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã, —Å–∫–µ–ø—Ç–∏–∫–∏)
- ‚úÖ Intent detection (product, business, skeptic, curious)
- ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ RAG –ø–æ–∏—Å–∫ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
- ‚úÖ Conversational Funnel (–≤–æ—Ä–æ–Ω–∫–∞)

### AI-–ö–æ–Ω—Ç–µ–Ω—Ç-–ú–µ–Ω–µ–¥–∂–µ—Ä
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤ (product, motivation, tips, success_story, news, promo)
- ‚úÖ –ü–µ—Ä—Å–æ–Ω—ã –∏ hooks
- ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞

---

## –ú–µ—Ç—Ä–∏–∫–∏

### –¶–µ–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (SLA)

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª–µ–≤–æ–µ | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ |
|---------|---------|-------------|
| **Avg Response Time** | < 1000 ms | < 2000 ms |
| **P95 Response Time** | < 1500 ms | < 3000 ms |
| **Error Rate** | < 0.1% | < 1% |
| **Throughput** | > 20 req/sec | > 10 req/sec |

–¢–µ—Å—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç SLA –∏ –ø–∞–¥–∞—é—Ç –µ—Å–ª–∏ –ª–∏–º–∏—Ç—ã –ø—Ä–µ–≤—ã—à–µ–Ω—ã.

---

## –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä

```python
from tests.load_testing.load_runner import quick_curator_test

async def my_handler(message):
    await message.answer("Response")

# –ó–∞–ø—É—Å–∫
metrics = await quick_curator_test(
    bot_handler=my_handler,
    users=10,
    concurrent=5
)

print(f"Error rate: {metrics['summary']['error_rate']:.2%}")
```

### –ö–∞—Å—Ç–æ–º–Ω—ã–π —Ç–µ—Å—Ç

```python
from tests.load_testing.load_runner import LoadTestRunner, LoadTestConfig

config = LoadTestConfig(
    test_name="my_test",
    total_users=50,
    concurrent_users=20,
    ramp_up_duration_sec=10.0,  # –ü–ª–∞–≤–Ω—ã–π —Ä–æ—Å—Ç
    export_html=True,
)

runner = LoadTestRunner(config)
metrics = await runner.run(bot_handler=my_handler)
```

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (—É–ø—Ä–æ—â—ë–Ω–Ω–æ)

```
LoadTestRunner
‚îú‚îÄ‚îÄ 100 VirtualUsers (personas)
‚îú‚îÄ‚îÄ MockAnthropicClient (smart mock —Å intent detection)
‚îú‚îÄ‚îÄ MockRAGEngine (keyword search)
‚îú‚îÄ‚îÄ MockPersonaManager (3 –ø–µ—Ä—Å–æ–Ω—ã)
‚îî‚îÄ‚îÄ MetricsCollector + HTMLReporter
```

**Smart Mocks** ‚Äî —ç–º—É–ª–∏—Ä—É—é—Ç AI –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö API –≤—ã–∑–æ–≤–æ–≤, —ç–∫–æ–Ω–æ–º—è—Ç $$$ –∏ –≤—Ä–µ–º—è.

---

## FAQ

**Q: –ù—É–∂–Ω–∞ –ª–∏ —Ä–µ–∞–ª—å–Ω–∞—è –ë–î?**
A: –ù–µ—Ç, —Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç SQLite in-memory –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

**Q: –ú–æ–∂–Ω–æ –ª–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π AI?**
A: –î–∞, –∑–∞–º–µ–Ω–∏—Ç–µ mock clients –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ, –Ω–æ —ç—Ç–æ –¥–æ—Ä–æ–≥–æ –∏ –º–µ–¥–ª–µ–Ω–Ω–æ.

**Q: –ö–∞–∫ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏?**
A: –û—Ç–∫—Ä–æ–π—Ç–µ `{test_name}_raw_metrics.csv` –∏ –Ω–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ —Å `success=False`.

**Q: –ö–∞–∫ —É–≤–µ–ª–∏—á–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É?**
A: –£–≤–µ–ª–∏—á—å—Ç–µ `total_users` –∏ `concurrent_users` –≤ –∫–æ–Ω—Ñ–∏–≥–µ.

---

## –ß—Ç–æ –¥–∞–ª—å—à–µ?

### –ò–∑—É—á–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- [–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](../../docs/LOAD_TESTING_SYSTEM.md)
- [README](./README.md)
- [–ü—Ä–∏–º–µ—Ä—ã](./example_test.py)

### –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–≤–æ–∏ —Ç–µ—Å—Ç—ã
1. –°–æ–∑–¥–∞–π—Ç–µ handler –¥–ª—è –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ quick test
3. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –º–µ—Ç—Ä–∏–∫–∏
4. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ bottlenecks
5. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ

### –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ –≤ CI/CD
- Smoke test –Ω–∞ –∫–∞–∂–¥—ã–π PR
- Full load test nightly
- –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç –ø–µ—Ä–µ–¥ —Ä–µ–ª–∏–∑–æ–º

---

## –ü–æ–º–æ—â—å

–ü—Ä–æ–±–ª–µ–º—ã? –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ª–∏ matplotlib –∏ Jinja2
2. –ó–∞–ø—É—â–µ–Ω –ª–∏ —Ç–µ—Å—Ç –∏–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
3. –ù–µ—Ç –ª–∏ –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö pytest

–ù–µ –ø–æ–º–æ–≥–ª–æ? –ò–∑—É—á–∏—Ç–µ [Troubleshooting](../../docs/LOAD_TESTING_SYSTEM.md#troubleshooting) –≤ –ø–æ–ª–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

---

**–ì–æ—Ç–æ–≤–æ!** –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç–æ–≤ –ø–æ–¥ —Ä–µ–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π.

**–í—Ä–µ–º—è –Ω–∞ –æ—Å–≤–æ–µ–Ω–∏–µ:** 5 –º–∏–Ω—É—Ç
**–í—Ä–µ–º—è –Ω–∞ –ø–µ—Ä–≤—ã–π —Ç–µ—Å—Ç:** 30 —Å–µ–∫—É–Ω–¥
**–≠–∫–æ–Ω–æ–º–∏—è –Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏:** 10+ —á–∞—Å–æ–≤ —Ä—É—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã

üöÄ **Happy Testing!**
