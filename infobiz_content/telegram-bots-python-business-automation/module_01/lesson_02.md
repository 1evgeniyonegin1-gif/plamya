# Проектирование UX и логики: Диаграммы состояний и сценарии

> Модуль 1: Стратегия и проектирование: От бизнес-задачи к ТЗ бота
> Тип: theory

---

# Урок: Проектирование UX и логики: Диаграммы состояний и сценарии

## Введение

После того как вы определили бизнес-задачу и модель монетизации для вашего Telegram-бота, наступает самый важный этап перед написанием кода — проектирование. Представьте, что вы строите дом. У вас есть участок (бизнес-задача) и бюджет (unit-экономика). Но без чёткого плана, чертежей и схем вы рискуете построить что-то неустойчивое и неудобное. Так и с ботом: без продуманного пользовательского опыта (UX) и логики он превратится в лабиринт, из которого клиенты не захотят искать выход.

В этом уроке мы научимся создавать эти самые "чертежи" для бота. Мы разберём, как визуализировать путь пользователя, проектировать диалоги и описывать логику работы с помощью диаграмм и сценариев. Это сэкономит вам десятки часов на переделке кода и сделает вашего бота удобным и эффективным инструментом.

## Что такое UX и логика бота?

**UX (User Experience)** — это весь опыт, который получает пользователь при взаимодействии с вашим ботом. Насколько ему понятно, что делать? Не возникает ли у него раздражения? Достигает ли он своей цели быстро и просто?

**Логика бота** — это внутренняя "прошивка", набор правил и условий, которые определяют, как бот реагирует на действия пользователя. Если UX — это удобная дорога с указателями, то логика — это работа светофоров, развязок и правила движения по этой дороге.

Проектирование — это процесс соединения UX и логики в единый, рабочий план.

## Инструмент №1: User Flow (Пользовательский поток)

User Flow — это схема, которая показывает путь пользователя от первой команды (например, `/start`) до конечной цели (например, получения заказа или записи на приём).

**Зачем это нужно?**
*   Чтобы увидеть весь путь глазами пользователя.
*   Чтобы найти "узкие" места, где пользователь может запутаться или уйти.
*   Чтобы согласовать этот путь с заказчиком или командой до начала разработки.

**Как это выглядит?**
Это блок-схема, состоящая из:
1.  **Точек входа** (стартовая команда, кнопка в другом чате).
2.  **Экранов/состояний бота** (главное меню, форма ввода данных, подтверждение).
3.  **Действий пользователя** (нажатие кнопки, ввод текста).
4.  **Реакций бота** (показать меню, задать вопрос, отправить чек).
5.  **Конечных точек** (успешное завершение, выход в меню).

> **Простая аналогия:** User Flow для бота-заказа еды — это как карта прохождения уровня в игре: "Нажми Старт" → "Выбери категорию" → "Выбери блюдо" → "Укажи адрес" → "Оплати" → "Получи подтверждение".

## Инструмент №2: Диаграмма состояний (State Diagram) или Карта диалога

Если User Flow — это вид сверху на всю карту, то Диаграмма состояний — это детальная схема каждого перекрёстка. В разработке ботов это часто называют **Finite State Machine (FSM)** — машина конечных состояний.

**Состояние (State)** — это конкретный "экран" или "режим", в котором находится бот в диалоге с конкретным пользователем. В этом состоянии бот ждёт определённого ввода.

**Пример состояний для бота записи к врачу:**
*   `MainMenu`: Бот показывает главные кнопки ("Записаться", "Мои записи", "Контакты").
*   `ChoosingSpecialization`: Бот ждёт, когда пользователь выберет специализацию из списка.
*   `ChoosingDoctor`: Бот ждёт выбора конкретного врача.
*   `ChoosingDateTime`: Бот ждёт выбора даты и времени из календаря.
*   `EnteringPhone`: Бот ждёт ввода номера телефона для подтверждения.

**Как строится диаграмма?**
Вы рисуете состояния (обычно в овалах или прямоугольниках) и соединяете их стрелками. На стрелках пишете **событие** (что сделал пользователь), которое приводит к переходу из одного состояния в другое.

```
[MainMenu] -- "Пользователь нажал 'Записаться'" --> [ChoosingSpecialization]
[ChoosingSpecialization] -- "Пользователь выбрал 'Терапевт'" --> [ChoosingDoctor]
[ChoosingDoctor] -- "Пользователь выбрал доктора Иванова" --> [ChoosingDateTime]
[ChoosingDateTime] -- "Пользователь выбрал 25.04 14:00" --> [EnteringPhone]
[EnteringPhone] -- "Пользователь ввёл номер" --> [AppointmentConfirmed]
```

**Зачем это нужно разработчику?**
Эта диаграмма почти один в один превращается в код. Каждое состояние — это часто отдельная функция-обработчик. Стрелки — это условия (`if/elif`) в вашей программе. С этой схемой писать код становится в разы проще.

## Инструменты для проектирования

Вам не нужны сложные профессиональные программы. Начните с этих:

1.  **Miro (miro.com)**: Бесплатный онлайн-доска с кучей готовых шаблонов, включая шаблоны для User Flow и диаграмм состояний. Очень наглядно, удобно для командной работы.
2.  **Draw.io (diagrams.net)**: Бесплатный и очень мощный инструмент для создания любых диаграмм. Работает прямо в браузере. Идеален для детальных технических схем. Можно сохранять диаграммы в Google Drive.
3.  **Figma (figma.com)**: Если вы хотите нарисовать не только схему, но и примерный внешний вид кнопок и меню (прототип интерфейса), Figma — отличный выбор. Есть бесплатный тариф.

**Совет:** Начните с листа бумаги или доски. Набросайте основную идею, а затем переносите в цифровой инструмент для чистовика и совместного доступа.

## Шаблоны сценариев для типовых задач

Многие бизнес-задачи в ботах решаются по похожим сценариям. Используйте эти шаблоны как основу.

### Шаблон 1: Сбор данных (заказ, запись, анкета)
**Цель:** Последовательно получить от пользователя несколько данных.
**Логика состояний:**
1.  `START` -> Приветствие и запрос первого поля (например, "Введите ваше имя").
2.  `WAITING_FOR_NAME` -> Получаем имя, сохраняем, запрашиваем следующее поле ("Введите email").
3.  `WAITING_FOR_EMAIL` -> Получаем email, сохраняем, запрашиваем телефон.
4.  `WAITING_FOR_PHONE` -> Получаем телефон, сохраняем ВСЕ данные, показываем сводку и кнопку "Подтвердить".
5.  `CONFIRMATION` -> При подтверждении выполняем действие (создаём заказ в БД) и отправляем успешное сообщение.

### Шаблон 2: Многоуровневое меню (каталог, справочник)
**Цель:** Позволить пользователю углубляться в иерархическую структуру.
**Логика:**
*   Каждый уровень меню — своё состояние.
*   В каждом состоянии бот показывает кнопки с пунктами этого уровня.
*   Выбор пункта ведёт либо в состояние со следующим уровнем меню, либо к показу контента (товара, статьи).
*   Всегда есть кнопка "Назад", которая возвращает в состояние предыдущего уровня. Кнопка "В главное меню" сбрасывает цепочку в начальное состояние.

### Шаблон 3: Обратная связь или тикет
**Цель:** Принять вопрос/проблему и обеспечить ответ.
**Логика:**
1.  Пользователь выбирает "Поддержка" или "Задать вопрос".
2.  Бот переходит в состояние `WAITING_FOR_QUESTION` и просит написать сообщение.
3.  Полученный текст сохраняется в базу как новый тикет с статусом "Открыт".
4.  Бот автоматически уведомляет администратора (в Telegram) о новом тикете.
5.  Администратор может ответить прямо из своего Telegram. Бот перешлёт ответ пользователю.
6.  Диалог может продолжаться. Состояние пользователя при этом не меняется, он всегда может написать новое сообщение в рамках этого тикета.

## Практический пример: Бот для мини-кофейни

**Задача:** Приём заказов на вынос.

**User Flow (упрощённо):**
`/start` -> Приветствие и кнопка "Сделать заказ" -> Выбор категории ("Кофе", "Десерты") -> Выбор товара -> Добавление в корзину -> Возврат к выбору или переход к оформлению -> Указание имени для заказа -> Подтверждение -> Заказ уходит бариста в отдельный чат.

**Диаграмма состояний (ключевые состояния):**
*   `MainMenu`: ["Сделать заказ", "Контакты", "Акции"]
*   `ChoosingCategory`: Список категорий. При выборе -> состояние `ChoosingProduct`.
*   `ChoosingProduct`: Список товаров в выбранной категории. При выборе -> состояние `AddingToCart` (запрос количества).
*   `Cart`: Показ корзины. Кнопки ["Добавить ещё", "Оформить"]. "Оформить" -> состояние `EnteringName`.
*   `EnteringName`: Ожидание ввода имени. После ввода -> состояние `Confirmation` (показ итога).
*   `Confirmation`: Кнопки ["Подтвердить заказ", "Отменить"]. "Подтвердить" -> заказ сохраняется, пользователь получает благодарность, бот возвращается в `MainMenu`.

## Ключевые выводы

1.  **Проектирование — это фундамент.** Потратьте время на создание User Flow и диаграммы состояний, чтобы не переделывать код потом. Это окупится сторицей.
2.  **User Flow** помогает увидеть весь путь пользователя целиком, а **Диаграмма состояний (FSM)** — детально описать логику в каждом его шаге. Используйте их вместе.
3.  **Состояние бота** — это ключевое понятие. Чётко определяйте, в каком состоянии находится диалог и что бот ожидает от пользователя в этот момент.
4.  **Используйте шаблоны** для типовых задач (сбор данных, меню, поддержка). Это ускорит проектирование и сделает логику предсказуемой.
5.  **Выбирайте инструменты под задачу:** Miro/Draw.io для схем, Figma для прототипов интерфейса. Начинать можно с простой бумаги.

## Практика

1.  **Разбор кейса:** Возьмите бизнес-кейс из предыдущего урока (например, бот для записи в школьный кружок). Нарисуйте для него **User Flow** от лица родителя, который хочет записать ребёнка. Отметьте на схеме минимум 5 ключевых шагов и одну возможную точку выхода (где пользователь может передумать).

2.  **Создание диаграммы:** Для того же бота записи в кружок выделите 4-5 основных **состояний** (например, `ВыборКружка`, `ВыборВремени`, `ВводИмениРебёнка`). Нарисуйте простую диаграмму состояний на бумаге или в Draw.io, показав, как пользователь переходит между ними (какие кнопки нажимает).

3.  **Шаблон в деле:** Опишите текстом (по пунктам) **сценарий работы** бота для приёма заявок на обратный звонок в небольшую компанию по ремонту техники. Используйте шаблон "Сбор данных". Что будет спрашивать бот? В каком порядке? Что произойдёт после заполнения всех данных?